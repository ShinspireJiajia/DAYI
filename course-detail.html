<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>èª²ç¨‹è©³æƒ… - æ™ºç”Ÿæ´»</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    .course-image { width:100%; height:200px; object-fit:cover; border-radius:16px; margin-bottom:16px; }
    .course-header { padding:0 0px 16px 0px; }
    .course-title { font-size:18px; font-weight:600; color:#000; margin-bottom:8px; line-height: 1.3; }
    .course-badges { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
    .badge { font-size:14px; padding:6px 10px; border-radius:999px; font-weight:700; }
    .badge-type { background:#e8f5e8; color:#2e7d32; }
    .status-available {background: rgb(25, 79, 91, 0.08);color: rgb(25, 79, 91, 0.8);}
    .status-waitlist { background:#fff7ed; color:#c2410c; }
    .status-full { background:#f3f4f6; color:#9ca3af; }
    
    .info-section { background:#fff; border-radius:12px; padding:12px; margin:8px 0px; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
    .section-title-s { font-size:16px; font-weight:600; color:#000; margin:8px 0 12px 0; display:flex; align-items:center; gap:8px; }
    .info-row { display:grid; grid-template-columns:80px 1fr; gap:12px; padding:8px 0; border-bottom:1px solid #f3f4f6; align-items: flex-start; }
    .info-row:last-child { border-bottom:none; }
    .info-label { font-size:16px; color:#666; font-weight:400; line-height: 1.5; }
    .info-value { font-size:16px; color:#000; font-weight:600; line-height: 1.5; }
    .info-value.highlight { color: #194f5b; font-weight: 800; font-size: 16px; }
    
    .description { color:#000; line-height:1.8; font-size: 16px; }
    .description li { margin-left: 15px; }
    .materials-checkbox { margin:8px 0; }
    .materials-checkbox input { margin-right:8px; }
    .materials-checkbox label { font-size:14px; color:#374151; }
    .course-detail-list{margin-left:8px;}
    .course-detail-list li::marker {
    color: #00b4b4; /* é€™è£¡æ›æˆä½ æƒ³è¦çš„ä¸»è‰² */
    font-size: 1.2em; /* ä¹Ÿå¯ä»¥èª¿æ•´å¤§å° */
}
    .booking-section { position:fixed; bottom:0; left:50%; transform:translateX(-50%); width:100%; max-width:414px; background:#fff; padding:16px; border-radius:24px 24px 0 0;box-shadow:0 -4px 12px rgba(0,0,0,0.1); z-index:100; display: flex; flex-direction: column; gap: 12px; box-sizing: border-box; }
    .booking-info { display:flex; flex-direction: column; align-items: flex-start; gap: 4px; width: 100%; }
    .price-info { font-size:20px; font-weight:800; color:#194f5b; }
    .points-info { font-size:16px; color:#6b7280; word-wrap: break-word; }
    .btn-book-detail {width: 100%;
    padding: 16px;
    background: #00b4b4;
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s;
    box-shadow: 0 4px 12px rgba(0, 180, 180, 0.3);}
    .btn-waitlist-detail { width:100%; background:#ff9800; color:#fff; border:none; padding:14px; border-radius:12px; font-size:18px; font-weight:700; cursor:pointer; }
    
    .main-content { padding-bottom:200px; }

   
  </style>
</head>
<body>
  <!-- Status Bar -->
  <div class="status-bar">
    <span class="time">15:10</span>
    <div class="signal-battery">
      <span class="signal">
        <i class="fas fa-signal"></i>
        <span class="network">5G</span>
      </span>
      <i class="fas fa-battery-three-quarters"></i>
    </div>
  </div>

  <!-- App Header -->
  <header class="app-header">
    <div class="header-left">
      <div class="app-logo">
        <a href="course-booking.html" id="backLink" aria-label="è¿”å›" class="back-link"><i class="fas fa-chevron-left"></i></a>
        <span class="app-name">èª²ç¨‹è©³æƒ…</span>
      </div>
    </div>
    <div class="header-right">
      <a href="member-code.html" aria-label="æœƒå“¡æ¢ç¢¼" class="header-action"><i class="fas fa-qrcode"></i></a>
      <i class="fas fa-comment-dots"></i>
      <i class="fas fa-bell"></i>
    </div>
  </header>

  <main class="pages-content">
    <img id="courseImage" class="course-image" src="./images/course-detail-img.png" alt="èª²ç¨‹åœ–ç‰‡" />
    
    <div class="course-header">
      <h1 id="courseTitle" class="course-title">èª²ç¨‹åç¨±</h1>
      <div class="course-badges" id="courseBadges"></div>
      <p id="courseDescription" class="description">èª²ç¨‹ç°¡ä»‹...</p>
    </div>

    <div class="info-section">
      <div class="section-title-s">
        èª²ç¨‹è³‡è¨Š
      </div>
      <div class="info-row">
        <div class="info-label">èª²ç¨‹ä»£ç¢¼</div>
        <div class="info-value" id="courseCode">â€”</div>
      </div>
      <div class="info-row">
        <div class="info-label">æ´»å‹•æ—¥æœŸ</div>
        <div class="info-value highlight" id="courseDateTime">â€”</div>
      </div>
      <div class="info-row">
        <div class="info-label">å¸«è³‡åç¨±</div>
        <div class="info-value" id="courseInstructor">â€”</div>
      </div>
      <div class="info-row">
        <div class="info-label">æ´»å‹•åé¡</div>
        <div class="info-value" id="courseCapacity">â€”</div>
      </div>

      <div class="info-row">
        <div class="info-label">è²»ç”¨</div>
        <div class="info-value" id="courseFee">â€”</div>
      </div>
      <div class="info-row">
        <div class="info-label">æ´»å‹•åœ°é»</div>
        <div class="info-value" id="courseLocation">â€”</div>
      </div>
      <div class="info-row">
        <div class="info-label">å ±åæœŸé™</div>
        <div class="info-value" id="registrationDeadline">â€”</div>
      </div>
    </div>

    <div class="info-section" id="materialsSection">
      <div class="section-title-s">
        <i class="fas fa-shopping-cart"></i>
        ææ–™è³¼è²·éœ€æ±‚
      </div>
      <div id="materialsInfo"></div>
      <div id="materialsPurchase" style="display:none;">
        <!-- <div class="materials-checkbox">
          <input type="checkbox" id="buyMaterials" />
          <label for="buyMaterials">æˆ‘éœ€è¦è³¼è²·èª²ç¨‹ææ–™</label>
        </div> -->
      </div>
    </div>

    <div class="info-section">
      <div class="section-title-s">
        <i class="fas fa-info-circle"></i>
        æ³¨æ„äº‹é …
      </div>
      <div id="courseNotes" class="description">
        <ul class="course-detail-list">
          <li>è«‹ç©¿è‘—èˆ’é©é‹å‹•æœè£</li>
          <li>è«‹è‡ªå‚™æ¯›å·¾èˆ‡æ°´ç“¶</li>
          <li>èª²ç¨‹æœŸé–“è«‹å°‡æ‰‹æ©Ÿèª¿ç‚ºéœéŸ³</li>
        </ul>
      </div>
    </div>
  </main>

  <!-- Booking Section -->
  <div class="booking-section">
    <div class="booking-info">
      <div class="points-info">é ç´„æ­¤èª²ç¨‹éœ€è¦</div>
      <div class="price-info" id="priceDisplay">5 é»</div>
      <div class="charge-info" id="chargeInfo" style="display:none;">
        <div style="font-size:14px; color:#ff6b35; font-weight:600; margin-top:4px;">
          æ›å¸³é‡‘é¡ï¼šNT$<span id="chargeAmount">0</span> å…ƒ
        </div>
      </div>
    </div>
    <button id="bookingBtn" class="btn-book-detail">ç«‹å³é ç´„</button>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a class="nav-item" href="index.html">
      <i class="fas fa-home"></i>
      <span>é¦–é </span>
    </a>
    <a class="nav-item active" href="space-booking.html">
      <i class="fas fa-concierge-bell"></i>
      <span>æˆ‘è¦é ç´„</span>
    </a>
    <div class="nav-item">
      <i class="fas fa-wallet"></i>
      <span>éŒ¢åŒ…</span>
    </div>
    <a class="nav-item" href="personal.html">
      <i class="fas fa-user"></i>
      <span>å€‹äºº</span>
    </a>
  </nav>
  <div class="home-indicator"></div>

  <!-- Popup Modal -->
  <div id="popupOverlay" class="popup-overlay">
    <div class="popup-content">
      <i id="popupIcon" class="popup-icon fas fa-info-circle"></i>
      <div id="popupTitle" class="popup-title"></div>
      <div id="popupMessage" class="popup-message"></div>
      <div class="popup-actions">
        <button id="popupCancelBtn" class="popup-btn cancel">å–æ¶ˆ</button>
        <button id="popupConfirmBtn" class="popup-btn confirm">ç¢ºå®š</button>
      </div>
    </div>
  </div>

  <!-- Booking Modal Sheet -->
  <div class="modal-overlay" id="modal">
    <div class="modal-container">
        <div class="modal-header">
            <h2>èª²ç¨‹æ´»å‹•é ç´„ç¢ºèª</h2>
            <button class="close-btn" id="closeSheet">&times;</button>
        </div>
        
        <div class="course-summary">
            <!-- <img src="" alt="Course Image" class="course-img" id="s-img"> -->
            <div class="course-info">
                <div class="course-title" id="s-name"></div>
                <div class="course-meta"><i class="fas fa-barcode"></i> <span id="s-code"></span></div>
                <div class="course-meta"><i class="far fa-clock"></i> <span id="s-time"></span></div>
                <div class="course-meta"><i class="fas fa-map-marker-alt"></i> <span id="s-site"></span></div>
                <div class="course-meta"><i class="far fa-user"></i> <span id="s-instructor"></span></div>
                <div style="display: flex; align-items: center; gap: 12px; margin-top: 12px;">
                    <div class="course-points" id="s-points" style="margin-top: 0; font-size: 16px;"></div>
                    <a href="course-detail.html" class="view-details-link" style="margin-top: 0; color: #b3a68b;">æŸ¥çœ‹å®Œæ•´æ´»å‹•è©³æƒ… <i class="fas fa-chevron-right"></i></a>
                </div>
            </div>
        </div>

        <div id="payment-section">
            <div class="section-title-s">é¸æ“‡ä»˜è²»æ–¹å¼</div>
            <div class="option-card selected" onclick="selectOption(this, 'payment')" data-value="points">
                <div class="option-content">
                    <div class="option-icon"><img src="./images/money-icon.png"></div>
                    <div class="option-text">
                        <span class="option-label">ä½¿ç”¨é»æ•¸</span>
                        <span class="option-sub" id="points-sub"></span>
                    </div>
                </div>
                <div class="radio-circle"></div>
            </div>

            <div class="option-card" onclick="selectOption(this, 'payment')" data-value="bill">
                <div class="option-content">
                    <div class="option-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                    <div class="option-text">
                        <span class="option-label">åˆ—å…¥å®¢æˆ¿å¸³å–®æ”¯ä»˜</span>
                        <span class="option-sub" id="bill-sub"></span>
                    </div>
                </div>
                <div class="radio-circle"></div>
            </div>
        </div>

        <div id="material-fee-section" style="display:none; margin-bottom: 24px;">
            <div class="section-title-s">èª²ç¨‹ææ–™è²» (å¯é¸)</div>
            <div id="material-description" style="margin-bottom: 12px; font-size: 16px; color: #4b5563; line-height: 1.5;"></div>
            <div id="material-items-container">
                <!-- Dynamic items will be injected here -->
            </div>
            <div style="font-size: 16px; color: #47727c; margin-top: 4px; padding-left: 4px;">
                <i class="fas fa-info-circle"></i> æ­¤è²»ç”¨å°‡åˆ—å…¥å®¢æˆ¿å¸³å–®æ”¶å–ï¼Œç„¡æ³•ä½¿ç”¨é»æ•¸æŠ˜æŠµã€‚
            </div>
        </div>

        <div class="agreement-box" style="justify-content: center; text-align: center;">
            <div class="agreement-text" style="color: #47727c; font-size: 16px;">
                ç‚ºäº†è®“æ‚¨æœ‰æ›´å¥½çš„é«”é©—ï¼Œå¦‚æœæ‚¨é»é¸ç¢ºèªé ç´„ï¼Œè¡¨ç¤ºæ‚¨å·²åŒæ„ <a href="course-notice.html" class="agreement-link" style="color: #00b4b4; text-decoration: underline;">èª²ç¨‹æ´»å‹•é ˆçŸ¥èªªæ˜</a>
            </div>
        </div>

        <button class="confirm-btn" id="confirmBooking">ç¢ºèªé ç´„</button>
    </div>
  </div>

  <script>
    // èª²ç¨‹è³‡æ–™ (èˆ‡ course-booking.html åŒæ­¥)
    const COURSES = [
      { 
        id:'C101', 
        name:'æ¨‚é½¡è‚ŒåŠ›è¨“ç·´', 
        category: 'é‹å‹•å¥åº·',
        tags: ['æˆ¶å¤–', 'è‚ŒåŠ›'], 
        day:'2026/5/15', 
        time:'10:00-11:00', 
        site:'Aæ£Ÿ3F å¤šåŠŸèƒ½å®¤', 
        maxSeats: 12,
        activityQuota: '12äºº',
        availableSeats: 4, 
        points: 500,
        sessions: 8,
        fee: 'æ‰£é»',
        note:'è¼•é‡å•éˆ´ã€å½ˆåŠ›å¸¶ï¼Œæå‡è‚Œè€åŠ›',
        description: '<strong>ğŸŒŸ æ¨‚é½¡è‚ŒåŠ›è¨“ç·´ï¼šé‡æ‹¾æ´»åŠ›èˆ‡å¹³è¡¡</strong><br><br><strong>èª²ç¨‹ç°¡ä»‹ï¼š</strong> éš¨è‘—å¹´é½¡å¢é•·ï¼Œè‚Œè‚‰åŠ›é‡æœƒé€æ¼¸æµå¤±ï¼Œé€²è€Œå½±éŸ¿ç”Ÿæ´»å“è³ªã€‚æœ¬å¥—ã€Œæ¨‚é½¡è‚ŒåŠ›è¨“ç·´ã€èª²ç¨‹ç”±è³‡æ·±ç‰©ç†æ²»ç™‚å¸«/å°ˆæ¥­æ•™ç·´è¨­è¨ˆï¼Œæ¡ç”¨æº«å’Œä¸”æœ‰æ•ˆçš„è¨“ç·´æ–¹æ³•ï¼Œå¹«åŠ© 50 æ­²ä»¥ä¸Šçš„å­¸å“¡å®‰å…¨åœ°é€²è¡ŒåŠ›é‡è¨“ç·´ã€‚èª²ç¨‹ä¸­å°‡æœƒåˆ©ç”¨è¼•é‡å™¨ææˆ–è‡ªèº«é‡é‡ï¼Œå°ˆæ³¨æ–¼æå‡å¤§è‚Œç¾¤åŠ›é‡ã€æ”¹å–„é—œç¯€æ´»å‹•åº¦åŠå¢é€²èº«é«”å¹³è¡¡æ„Ÿã€‚<br><br><strong>èª°é©åˆåƒåŠ ï¼Ÿ</strong><ul><li>å¸Œæœ›æ”¹å–„èµ°è·¯å§¿å‹¢ã€é˜²æ­¢é§èƒŒè€…ã€‚</li><li>æ“”å¿ƒè·Œå€’ã€å¸Œæœ›æå‡èº«é«”ç©©å®šæ€§è€…ã€‚</li><li>å¸Œæœ›ä¿æŒæ´»åŠ›ã€äº«å—æ›´é«˜å“è³ªé€€ä¼‘ç”Ÿæ´»è€…ã€‚</li></ul><strong>èª²ç¨‹å…§å®¹æ ¸å¿ƒï¼š</strong><ul><li>å®‰å…¨æš–èº«èˆ‡é—œç¯€æ´»å‹•åº¦è¨“ç·´ã€‚</li><li>ä¸‹è‚¢åŠ›é‡ï¼ˆå¤§è…¿ã€è‡€éƒ¨ï¼‰å¼·åŒ–ï¼Œæå‡ç«™ç«‹èˆ‡è¡Œèµ°èƒ½åŠ›ã€‚</li><li>æ ¸å¿ƒè‚Œç¾¤ç©©å®šæ€§ç·´ç¿’ï¼Œä¿è­·è„Šæ¤ã€‚</li><li>èª²å¾Œèˆ’ç·©ä¼¸å±•ï¼Œæ”¾é¬†ç·Šç¹ƒè‚Œè‚‰ã€‚</li></ul>',
        instructor: 'é™³ç¾ç²è€å¸«',
        materials: 'éœ€è‡ªå‚™æ¯›å·¾ï¼Œå…¶ä»–å™¨æç”±èª²ç¨‹æä¾›',
        registrationDeadline: '2025/09/25',
        image: 'https://placehold.co/600x400?text=Muscle+Training'
      },
      { 
        id:'C102', 
        name:'è…°èƒŒèˆ’ç·©æ ¸å¿ƒç‘œçˆ', 
        category: 'é‹å‹•å¥åº·',
        tags: ['ç‘œçˆ', 'èˆ’å±•'], 
        day:'é€±ä¸‰', 
        time:'14:00-15:00', 
        site:'Bæ£Ÿ2F æ•™å®¤A', 
        maxSeats: 15,
        availableSeats: 2, 
        points: 300,
        sessions: 6,
        fee: 'æ‰£é»',
        note:'ä¼¸å±•èˆ‡å‘¼å¸ï¼Œæ”¾é¬†èº«å¿ƒ',
        description: 'æº«å’Œçš„ç‘œçˆç·´ç¿’ï¼Œè‘—é‡å‘¼å¸èª¿ç¯€èˆ‡æŸ”è»Ÿåº¦æå‡ï¼Œé©åˆéŠ€é«®æ—ç¾¤ã€‚',
        instructor: 'ç‹éœæ€¡è€å¸«',
        materials: 'éœ€è‡ªå‚™ç‘œçˆå¢Š',
        registrationDeadline: '2025/09/23',
        image: 'https://placehold.co/600x400?text=Yoga'
      },
      { 
        id:'C103', 
        name:'æ›¸æ³•è‡¨æ‘¹åˆç´šç­', 
        category: 'è—æ–‡ä¼‘é–’',
        tags: ['æ›¸æ³•', 'éœå¿ƒ'], 
        day:'é€±äº”', 
        time:'09:30-10:30', 
        site:'Aæ£Ÿ1F äº¤èª¼å»³', 
        maxSeats: 20,
        availableSeats: 8, 
        points: 400,
        sessions: 10,
        fee: 'æ‰£é»',
        note:'ç°¡æ˜“ç¯€å¥å‹•ä½œï¼Œå¼·åŒ–å¿ƒè‚º',
        description: 'çµåˆéŸ³æ¨‚èˆ‡ç°¡æ˜“å‹•ä½œçš„æœ‰æ°§é‹å‹•ï¼Œæå‡å¿ƒè‚ºåŠŸèƒ½èˆ‡å”èª¿æ€§ã€‚',
        instructor: 'æå¿—æ˜è€å¸«',
        materials: 'ç©¿è‘—èˆ’é©é‹å‹•æœå³å¯',
        registrationDeadline: '2025/09/26',
        image: 'https://placehold.co/600x400?text=Rhythm'
      },
      { 
        id:'C104', 
        name:'å¤æ—¥ç·¨ç¹”æç±ƒ', 
        category: 'è—æ–‡ä¼‘é–’',
        tags: ['æ‰‹ä½œ', 'ç·¨ç¹”'], 
        day:'é€±äºŒ', 
        time:'15:30-16:30', 
        site:'Cæ£Ÿ2F å…±å­¸å®¤', 
        maxSeats: 10,
        availableSeats: 5, 
        points: 600,
        sessions: 4,
        fee: 'æ‰£é»',
        note:'æ‰‹ä½œã€å”èª¿æ“ä½œï¼Œç¶­æŒå°ˆæ³¨',
        description: 'é€éç›Šæ™ºéŠæˆ²èˆ‡æ‰‹ä½œæ´»å‹•åˆºæ¿€å¤§è…¦ï¼Œç¶­æŒèªçŸ¥åŠŸèƒ½èˆ‡å°ˆæ³¨åŠ›ã€‚',
        instructor: 'å¼µéº—èŠ³è€å¸«',
        materials: 'ææ–™è²»å¦è¨ˆ NT$150',
        materialItems: [{name: 'ç·¨ç¹”ææ–™åŒ…', price: 150}],
        registrationDeadline: '2025/09/24',
        image: 'https://placehold.co/600x400?text=Brain+Training'
      },
      { 
        id:'C105', 
        name:'é—œç¯€ä¿å¥æ“', 
        category: 'é‹å‹•å¥åº·',
        tags: ['ç‘œçˆ', 'å¾©å¥'], 
        day:'é€±å››', 
        time:'10:30-11:30', 
        site:'Aæ£Ÿ3F å¤šåŠŸèƒ½å®¤', 
        maxSeats: 12,
        availableSeats: 0, 
        points: 300,
        sessions: 6,
        fee: 'æ‰£é»',
        note:'ä½è¡æ“Šé—œç¯€æ´»å‹•ï¼Œæ¸›å°‘åƒµç¡¬',
        description: 'é‡å°é—œç¯€ä¿é¤Šè¨­è¨ˆçš„æº«å’Œé‹å‹•ï¼Œæ”¹å–„é—œç¯€éˆæ´»åº¦èˆ‡æ¸›å°‘åƒµç¡¬æ„Ÿã€‚',
        instructor: 'åŠ‰æƒ æ•è€å¸«',
        materials: 'éœ€è‡ªå‚™ç‘œçˆå¢Šèˆ‡æ¯›å·¾',
        registrationDeadline: '2025/09/23',
        image: 'https://placehold.co/600x400?text=Joint+Care'
      },
      { 
        id:'C109', 
        name:'å†¬å­£é¤Šç”Ÿè—¥è†³', 
        category: 'ç”Ÿæ´»æ‡‰ç”¨',
        tags: ['çƒ¹é£ª', 'é¤Šç”Ÿ'], 
        day:'2025/12/10', 
        time:'10:00-12:00', 
        site:'Bæ£§1F å»šè—æ•™å®¤', 
        maxSeats: 20,
        availableSeats: 10, 
        points: 60000,
        sessions: 1,
        fee: 'æ‰£é»',
        note:'å†¬å­£é€²è£œï¼Œå¥åº·ç¾å‘³',
        description: '<strong>ğŸ² å†¬å­£é¤Šç”Ÿè—¥è†³ï¼šæš–å¿ƒæš–èƒƒçš„å¥åº·ç¾å‘³</strong><br><br><strong>èª²ç¨‹ç°¡ä»‹ï¼š</strong> å¯’å†·çš„å†¬å¤©æ˜¯é€²è£œçš„æœ€ä½³æ™‚ç¯€ã€‚æœ¬èª²ç¨‹é‚€è«‹å°ˆæ¥­ä¸­é†«å¸«èˆ‡ç‡Ÿé¤Šå¸«ï¼Œæ•™æ‚¨å¦‚ä½•é‹ç”¨å¸¸è¦‹çš„ä¸­è—¥æçµåˆç•¶å­£é£Ÿæï¼Œçƒ¹èª¿å‡ºç¾å‘³åˆå¥åº·çš„é¤Šç”Ÿæ–™ç†ã€‚èª²ç¨‹ä¸­å°‡ä»‹ç´¹ä¸åŒé«”è³ªé©åˆçš„è—¥è†³ï¼Œä¸¦è¦ªæ‰‹è£½ä½œä¸€é“ç¶“å…¸è—¥è†³æ¹¯å“ã€‚<br><br><strong>èª°é©åˆåƒåŠ ï¼Ÿ</strong><ul><li>å®¹æ˜“æ‰‹è…³å†°å†·ã€ç•å¯’è€…ã€‚</li><li>å¸Œæœ›é€éé£²é£Ÿèª¿ç†æ”¹å–„é«”è³ªè€…ã€‚</li><li>å°ä¸­é†«è—¥è†³æ–™ç†æœ‰èˆˆè¶£è€…ã€‚</li></ul><strong>èª²ç¨‹å…§å®¹æ ¸å¿ƒï¼š</strong><ul><li>èªè­˜å¸¸è¦‹è—¥è†³é£ŸæåŠå…¶åŠŸæ•ˆã€‚</li><li>å­¸ç¿’å¦‚ä½•æŒ‘é¸èˆ‡è™•ç†ä¸­è—¥æã€‚</li><li>å¯¦ä½œç¤ºç¯„ï¼šç•¶æ­¸ç”Ÿè–‘ç¾Šè‚‰æ¹¯ / ç´ é£Ÿé¤Šç”Ÿæ¹¯ã€‚</li><li>ç¾å ´å“åšèˆ‡äº¤æµã€‚</li></ul>',
        instructor: 'å¼µåœ‹æ¦®è€å¸«',
        materials: 'é£Ÿæè²»å¦è¨ˆ 300 å…ƒ',
        materialItems: [{name: 'è—¥è†³é£ŸæåŒ…', price: 300}],
        registrationDeadline: '2025/12/05',
        image: 'https://placehold.co/600x400?text=Winter+Diet'
      },
      { 
        id:'C112', 
        name:'æ‰‹å·¥çš®ä»¶è£½ä½œ', 
        category: 'è—æ–‡ä¼‘é–’',
        tags: ['æ‰‹ä½œ', 'å·¥è—'], 
        day:'2025/12/25', 
        time:'14:00-16:00', 
        site:'Cæ£§2F å…±å­¸å®¤', 
        maxSeats: 8,
        availableSeats: 8, 
        points: 1000,
        sessions: 1,
        fee: 'æ‰£é»',
        note:'è£½ä½œå°ˆå±¬çš®ä»¶ï¼Œé«”é©—å·¥åŒ ç²¾ç¥',
        description: '<strong>ğŸ‘œ æ‰‹å·¥çš®ä»¶è£½ä½œï¼šè³ªæ„Ÿç”Ÿæ´»ï¼Œè¦ªæ‰‹æ‰“é€ </strong><br><br><strong>èª²ç¨‹ç°¡ä»‹ï¼š</strong> é«”é©—çš®é©å·¥è—çš„é­…åŠ›ï¼Œå¾é¸çš®ã€è£åˆ‡ã€æ‰“å­”åˆ°ç¸«è£½ï¼Œè¦ªæ‰‹è£½ä½œä¸€å€‹ç¨ä¸€ç„¡äºŒçš„çœŸçš®é›¶éŒ¢åŒ…æˆ–è­‰ä»¶å¥—ã€‚èª²ç¨‹ç”±å°ˆæ¥­çš®ä»¶è¨­è¨ˆå¸«æŒ‡å°ï¼Œå³ä½¿æ˜¯åˆå­¸è€…ä¹Ÿèƒ½è¼•é¬†ä¸Šæ‰‹ã€‚<br><br><strong>èª²ç¨‹ç‰¹è‰²ï¼š</strong><ul class="course-detail-list"><li>ä½¿ç”¨é«˜å“è³ªç¾©å¤§åˆ©æ¤é£é©ã€‚</li><li>å­¸ç¿’åŸºç¤çš®é©å·¥å…·ä½¿ç”¨èˆ‡æ‰‹ç¸«æŠ€å·§ã€‚</li><li>å¯å®¢è£½åŒ–åˆ»å­—ï¼Œæ‰“é€ å°ˆå±¬ç´€å¿µã€‚</li></ul>',
        instructor: 'é™³æµ©ç„¶è€å¸«',
        materials: 'ææ–™è²»å¦è¨ˆ NT$800 (å«çš®é©ã€äº”é‡‘ã€å·¥å…·ç§Ÿå€Ÿ)',
        materialItems: [{name: 'ç¾©å¤§åˆ©æ¤é£é©', price: 500}, {name: 'äº”é‡‘é…ä»¶çµ„', price: 300}],
        registrationDeadline: '2025/12/20',
        image: 'https://placehold.co/600x400?text=Leather+Craft'
      }
    ];

    // Popup Helper
    function showPopup({ title, message, icon = 'info', showCancel = false, confirmText = 'ç¢ºå®š', cancelText = 'å–æ¶ˆ', confirmClass = '' }) {
      return new Promise((resolve) => {
        const overlay = document.getElementById('popupOverlay');
        const iconEl = document.getElementById('popupIcon');
        const titleEl = document.getElementById('popupTitle');
        const messageEl = document.getElementById('popupMessage');
        const cancelBtn = document.getElementById('popupCancelBtn');
        const confirmBtn = document.getElementById('popupConfirmBtn');

        // Set content
        titleEl.textContent = title || '';
        titleEl.style.display = title ? 'block' : 'none';
        messageEl.textContent = message;
        
        // Set icon
        iconEl.className = 'popup-icon fas';
        if (icon === 'success') iconEl.classList.add('fa-check-circle');
        else if (icon === 'warning') { iconEl.classList.add('fa-exclamation-triangle'); iconEl.classList.add('warning'); }
        else if (icon === 'error') { iconEl.classList.add('fa-times-circle'); iconEl.classList.add('error'); }
        else { iconEl.classList.add('fa-info-circle'); iconEl.classList.add('info'); }

        // Set buttons
        confirmBtn.textContent = confirmText;
        confirmBtn.className = 'popup-btn confirm ' + confirmClass;
        
        if (showCancel) {
          cancelBtn.style.display = 'block';
          cancelBtn.textContent = cancelText;
        } else {
          cancelBtn.style.display = 'none';
        }

        // Show popup
        overlay.style.display = 'flex';
        // Trigger reflow
        overlay.offsetHeight;
        overlay.classList.add('show');

        // Event listeners
        const close = (result) => {
          overlay.classList.remove('show');
          setTimeout(() => {
            overlay.style.display = 'none';
            resolve(result);
          }, 300);
        };

        // Remove old listeners to avoid duplicates if called multiple times
        const newConfirmBtn = confirmBtn.cloneNode(true);
        const newCancelBtn = cancelBtn.cloneNode(true);
        confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
        cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

        newConfirmBtn.onclick = () => close(true);
        newCancelBtn.onclick = () => close(false);
      });
    }

    let selectedPayment = 'points';

    function selectOption(element, type) {
        const siblings = element.parentElement.querySelectorAll('.option-card');
        siblings.forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        
        const value = element.getAttribute('data-value');
        if (type === 'payment') {
            selectedPayment = value;
        }
    }

    function openSheet(course) {
      document.getElementById('s-name').textContent = course.name;
      document.getElementById('s-code').textContent = course.id;
      document.getElementById('s-time').textContent = `${course.day} ${course.time}`;
      document.getElementById('s-site').textContent = course.site;
      document.getElementById('s-instructor').textContent = course.instructor;
      document.getElementById('s-points').textContent = `${course.points} é»`;
      
      const userPoints = getUserPoints();
      const pointsSub = document.getElementById('points-sub');
      pointsSub.textContent = `ç¾æœ‰é»æ•¸: ${userPoints.toLocaleString()}é»`;
      
      if (userPoints >= course.points) {
          pointsSub.innerHTML += ' <span style="color:#b3a68b; font-weight:bold; font-size:14px; margin-left:4px;"><i class="fas fa-check-circle"></i> é»æ•¸è¶³å¤ </span>';
      } else {
          pointsSub.innerHTML += ' <span style="color:#d32f2f; font-weight:bold; font-size:14px; margin-left:4px;"><i class="fas fa-times-circle"></i> é»æ•¸ä¸è¶³</span>';
      }
      
      const chargeAmount = course.points * 10;
      document.getElementById('bill-sub').textContent = `NT$ ${chargeAmount.toLocaleString()}`;

      // Material Fee Logic
      const materialSection = document.getElementById('material-fee-section');
      const materialContainer = document.getElementById('material-items-container');
      materialContainer.innerHTML = ''; // Clear previous items
      
      let hasMaterials = false;

      if (course.materialItems && course.materialItems.length > 0) {
          hasMaterials = true;
          course.materialItems.forEach((item, index) => {
              const itemDiv = document.createElement('div');
              itemDiv.className = 'option-card selected';
              itemDiv.style.cursor = 'pointer';
              itemDiv.dataset.price = item.price;
              itemDiv.dataset.name = item.name;
              itemDiv.onclick = function() {
                  this.classList.toggle('selected');
                  updateTotalCharge();
              };

              itemDiv.innerHTML = `
                <div class="option-content">
                    <div class="option-icon"><i class="fas fa-tools"></i></div>
                    <div class="option-text">
                        <span class="option-label">${item.name}</span>
                        <span class="option-sub">NT$ ${item.price.toLocaleString()}</span>
                    </div>
                </div>
                <div class="radio-circle"></div>
              `;
              materialContainer.appendChild(itemDiv);
          });
      } else if (course.materialFee && course.materialFee > 0) {
          // Legacy support for single fee
          hasMaterials = true;
          const itemDiv = document.createElement('div');
          itemDiv.className = 'option-card selected';
          itemDiv.style.cursor = 'pointer'; // Allow deselection
          itemDiv.dataset.price = course.materialFee;
          itemDiv.dataset.name = 'ææ–™è²»';
          itemDiv.onclick = function() {
              this.classList.toggle('selected');
              updateTotalCharge();
          };

          itemDiv.innerHTML = `
            <div class="option-content">
                <div class="option-icon"><i class="fas fa-tools"></i></div>
                <div class="option-text">
                    <span class="option-label">ææ–™è²»ç”¨</span>
                    <span class="option-sub">NT$ ${course.materialFee.toLocaleString()}</span>
                </div>
            </div>
            <div class="radio-circle"></div>
          `;
          materialContainer.appendChild(itemDiv);
      }

      if (hasMaterials) {
          materialSection.style.display = 'block';
      } else {
          materialSection.style.display = 'none';
      }

      const isFull = course.availableSeats === 0;
      const paymentSection = document.getElementById('payment-section');
      
      if (isFull) {
          paymentSection.style.display = 'none';
          selectedPayment = null;
      } else {
          paymentSection.style.display = 'block';
          selectedPayment = 'points';
          const paymentOptions = paymentSection.querySelectorAll('.option-card');
          paymentOptions.forEach(el => el.classList.remove('selected'));
          paymentSection.querySelector('[data-value="points"]').classList.add('selected');
      }

      const btn = document.getElementById('confirmBooking');
      
      if (isFull) {
        btn.textContent = 'ç¢ºèªå€™è£œ';
      } else {
        btn.textContent = 'ç¢ºèªé ç´„';
      }
      
      // Store current course for booking
      window.currentBookingCourse = course;
      
      document.getElementById('modal').style.display = 'flex';
    }

    function closeSheet() {
        document.getElementById('modal').style.display = 'none';
    }

    async function loadCourseDetail() {
      const urlParams = new URLSearchParams(window.location.search);
      const courseId = urlParams.get('id');
      
      // Handle back link
      const fromPage = urlParams.get('from');
      if (fromPage === 'my-courses') {
        const backLink = document.getElementById('backLink');
        if (backLink) {
          backLink.href = 'courses.html';
          backLink.setAttribute('aria-label', 'è¿”å›æˆ‘çš„èª²ç¨‹');
        }
      }

      const course = COURSES.find(c => c.id === courseId);
      
      if (!course) {
        await showPopup({ title: 'éŒ¯èª¤', message: 'æ‰¾ä¸åˆ°èª²ç¨‹è³‡è¨Š', icon: 'error' });
        window.location.href = 'course-booking.html';
        return;
      }

      // å¡«å……åŸºæœ¬è³‡è¨Š
      document.getElementById('courseImage').src = course.image;
      document.getElementById('courseImage').alt = course.name;
      document.getElementById('courseTitle').textContent = course.name;
      document.getElementById('courseDescription').innerHTML = course.description;

      // é¡¯ç¤ºæ¨™ç±¤
      const badgesContainer = document.getElementById('courseBadges');
      const isFull = course.availableSeats === 0;
      const allowWaitlist = course.allowWaitlist !== false; // é è¨­å…è¨±å€™è£œï¼Œé™¤éæ˜ç¢ºè¨­å®šç‚º false

      let statusText, statusClass;
      if (isFull) {
        if (allowWaitlist) {
          statusText = 'å·²é¡æ»¿(å¯å€™è£œ)';
          statusClass = 'status-waitlist';
        } else {
          statusText = 'å·²é¡æ»¿';
          statusClass = 'status-full';
        }
      } else {
        statusText = 'å¯å ±å';
        statusClass = 'status-available';
      }
      
      let badgesHtml = '';
      
      // 1. é¡åˆ¥ (è—è‰²)
      if (course.category) {
        badgesHtml += `<span class="badge" style="background:rgb(25,79,91,0.08); color:rgb(25,79,91,0.8);">${course.category}</span>`;
      }

      // 2. æ¨™ç±¤ (ç°è‰²)
      if (course.tags && Array.isArray(course.tags)) {
        course.tags.forEach(tag => {
          badgesHtml += `<span class="badge" style="background:rgb(25,79,91,0.08); color:rgb(25,79,91,0.8);">#${tag}</span>`;
        });
      } else if (course.type) {
         // Fallback
         badgesHtml += `<span class="badge" style="background:rgb(25,79,91,0.08); color:rgb(25,79,91,0.8);">${course.type}</span>`;
      }

      // 3. ç‹€æ…‹
      badgesHtml += `<span class="badge ${statusClass}">${statusText}</span>`;

      badgesContainer.innerHTML = badgesHtml;

      // å¡«å……è©³ç´°è³‡è¨Š
      document.getElementById('courseCode').textContent = course.id;
      document.getElementById('courseDateTime').textContent = `${course.day} ${course.time}`;
      document.getElementById('courseInstructor').textContent = course.instructor;
      
      // å„ªå…ˆé¡¯ç¤º activityQuotaï¼Œè‹¥ç„¡å‰‡é¡¯ç¤º maxSeats
      if (course.activityQuota) {
          document.getElementById('courseCapacity').textContent = course.activityQuota;
      } else {
          document.getElementById('courseCapacity').textContent = `${course.maxSeats} äºº`;
      }
      
      document.getElementById('courseFee').textContent = `${course.points} é» (${course.fee})`;
      document.getElementById('courseLocation').textContent = course.site;
      document.getElementById('registrationDeadline').textContent = course.registrationDeadline;

      // ææ–™è³‡è¨Š
      document.getElementById('materialsInfo').textContent = course.materials;
      
      // å¦‚æœæœ‰æ˜ç¢ºçš„ materialFee å±¬æ€§ï¼Œæˆ–è€…æ–‡å­—æè¿°ä¸­æœ‰è²»ç”¨è³‡è¨Šï¼Œé¡¯ç¤ºè³¼è²·å€å¡Š
      if ((course.materialFee && course.materialFee > 0) || course.materials.includes('å¦è¨ˆ') || course.materials.includes('NT$')) {
        const purchaseDiv = document.getElementById('materialsPurchase');
        purchaseDiv.style.display = 'block';
        
        // å¦‚æœæœ‰ materialFeeï¼Œé¡¯ç¤ºæ›´æ˜ç¢ºçš„è²»ç”¨æç¤º
        if (course.materialFee && course.materialFee > 0) {
            purchaseDiv.innerHTML = `
                <div style="background-color:#f0f9ff; border:1px solid #b3e5fc; border-radius:8px; padding:12px; margin-top:8px;">
                    <div style="display:flex; align-items:center; gap:8px; color:#0277bd; font-weight:700; font-size:15px;">
                        <i class="fas fa-info-circle"></i>
                        æœ¬èª²ç¨‹éœ€å¦æ”¶ææ–™è²» NT$${course.materialFee}
                    </div>
                    <div style="font-size:13px; color:#546e7a; margin-top:4px; margin-left:24px;">
                        è²»ç”¨å°‡åˆ—å…¥å®¢æˆ¿å¸³å–®æ”¶å–ï¼Œç„¡æ³•ä½¿ç”¨é»æ•¸æŠ˜æŠµã€‚
                    </div>
                </div>
            `;
        }
      }

      // é ç´„æŒ‰éˆ•
      const bookingBtn = document.getElementById('bookingBtn');
      const priceDisplay = document.getElementById('priceDisplay');
      
      priceDisplay.textContent = `${course.points} é»`;

      // Check if already booked
      const bookings = JSON.parse(localStorage.getItem('sl_course_bookings') || '[]');
      const existingBooking = bookings.find(b => b.courseId === courseId && b.status !== 'å·²å–æ¶ˆ');

      if (existingBooking) {
          if (existingBooking.status === 'å·²å ±åˆ°') {
              bookingBtn.textContent = 'å·²å ±åˆ°';
              bookingBtn.style.backgroundColor = '#e0e0e0';
              bookingBtn.style.color = '#9e9e9e';
              bookingBtn.style.cursor = 'default';
              bookingBtn.disabled = true;
              bookingBtn.onclick = null;
          } else if (existingBooking.isWaitlist) {
              bookingBtn.textContent = 'å€™è£œä¸­';
              bookingBtn.className = 'btn-waitlist-detail';
              bookingBtn.disabled = true;
              bookingBtn.onclick = null;
          } else {
              bookingBtn.innerHTML = '<i class="fas fa-qrcode"></i> æˆ‘è¦å ±åˆ°';
              bookingBtn.className = 'btn-book-detail';
              bookingBtn.disabled = false;
              bookingBtn.onclick = () => {
                  window.location.href = `scan-checkin.html?id=${existingBooking.id}`;
              };
          }
          document.getElementById('chargeInfo').style.display = 'none';
          const pointsInfo = document.querySelector('.points-info');
          if (pointsInfo) pointsInfo.textContent = 'æ‚¨å·²é ç´„æ­¤èª²ç¨‹';
          return;
      }
      
      if (isFull) {
        if (allowWaitlist) {
          bookingBtn.textContent = 'åŠ å…¥å€™è£œ';
          bookingBtn.className = 'btn-waitlist-detail';
          bookingBtn.disabled = false;
        } else {
          bookingBtn.textContent = 'å·²é¡æ»¿';
          bookingBtn.style.backgroundColor = '#9ca3af';
          bookingBtn.style.cursor = 'not-allowed';
          bookingBtn.disabled = true;
        }
      } else {
        bookingBtn.textContent = 'ç«‹å³é ç´„';
        bookingBtn.className = 'btn-book-detail';
        bookingBtn.disabled = false;
      }

      // æª¢æŸ¥é»æ•¸ä¸¦é¡¯ç¤ºæ›å¸³é‡‘é¡
      const userPoints = getUserPoints();
      const chargeInfoElement = document.getElementById('chargeInfo');
      const chargeAmountElement = document.getElementById('chargeAmount');
      
      if (!isFull && userPoints < course.points) {
        // é»æ•¸ä¸è¶³æ™‚é¡¯ç¤ºæ›å¸³é‡‘é¡
        const shortfall = course.points - userPoints;
        const chargeAmountNT = shortfall * 10; // å‡è¨­ 1 é» = 10 å…ƒ
        chargeAmountElement.textContent = chargeAmountNT;
        chargeInfoElement.style.display = 'block';
        
        // æ›´æ–°é¡¯ç¤ºæ–‡å­—
        document.querySelector('.points-info').textContent = `æ‚¨æœ‰ ${userPoints} é»ï¼Œæ‚¨å¯ä»¥é¸æ“‡åˆ—å…¥ä¸‹æœŸå¸³å–®æ”¯ä»˜`;
      } else {
        chargeInfoElement.style.display = 'none';
        if (!isFull) {
          document.querySelector('.points-info').textContent = 'é ç´„æ­¤èª²ç¨‹éœ€è¦é»æ•¸';
        }
      }

      // ç¶å®šé ç´„äº‹ä»¶
      bookingBtn.onclick = () => {
        openSheet(course);
      };
    }

    // Event Listeners for Modal
    document.getElementById('closeSheet').addEventListener('click', closeSheet);
    
    document.getElementById('confirmBooking').addEventListener('click', async () => {
        const course = window.currentBookingCourse;
        if (!course) return;

        const isWaitlist = course.availableSeats === 0;
        const pointsNeeded = course.points;
        
        // New Logic: Get selected materials
        const selectedMaterials = getSelectedMaterials();
        const totalMaterialFee = selectedMaterials.reduce((sum, item) => sum + item.price, 0);

        let paymentMethod = selectedPayment;
        let chargeAmount = 0;

        const executeBooking = async (finalPaymentMethod, finalChargeAmount) => {
            // å„²å­˜é ç´„è¨˜éŒ„ï¼Œå‚³å…¥ selectedMaterials
            saveCourseBooking(course, isWaitlist, finalPaymentMethod, finalChargeAmount, selectedMaterials);

            if (isWaitlist) {
              await showPopup({ title: 'å·²åŠ å…¥å€™è£œ', message: 'å·²æˆåŠŸåŠ å…¥å€™è£œåå–®ï¼Œå¦‚æœ‰åé¡é‡‹å‡ºå°‡ä¾æ“šå€™è£œé †åºéè£œã€‚', icon: 'success' });
              closeSheet();
              window.location.href = 'courses.html'; 
            } else {
              let successMsg = '';
              if (finalPaymentMethod === 'charge') {
                successMsg = `æ›å¸³é‡‘é¡ï¼šNT$${finalChargeAmount} å…ƒ\nå°‡åˆ—å…¥æ–¼å®¢æˆ¿å¸³å–®ä¸€èµ·ç¹³è²»ã€‚\n\nè©³æƒ…è«‹æŸ¥çœ‹æˆ‘çš„èª²ç¨‹æ´»å‹•é ç´„ã€‚`;
              } else if (finalPaymentMethod === 'mixed') {
                 successMsg = `å·²æ‰£é™¤ç¾æœ‰é»æ•¸ï¼Œä¸¦æ›å¸³ NT$${finalChargeAmount} å…ƒã€‚\nè©³æƒ…è«‹æŸ¥çœ‹æˆ‘çš„èª²ç¨‹æ´»å‹•é ç´„ã€‚`;
              } else {
                successMsg = `å·²æ‰£é™¤ ${pointsNeeded} é»æ•¸ï¼Œè©³æƒ…è«‹æŸ¥çœ‹æˆ‘çš„èª²ç¨‹æ´»å‹•é ç´„ã€‚`;
              }
              
              await showPopup({ title: 'é ç´„æˆåŠŸ', message: successMsg, icon: 'success' });
              closeSheet();
              window.location.href = 'courses.html';
            }
        };

        if (!isWaitlist) {
            if (paymentMethod === 'points') {
                 const userPoints = getUserPoints();
                 if (userPoints < pointsNeeded) {
                     const fullChargeAmount = (pointsNeeded * 10) + totalMaterialFee;
                     const msg = `é»æ•¸ä¸è¶³ï¼éœ€è¦ ${pointsNeeded} é»ï¼Œæ‚¨ç›®å‰æœ‰ ${userPoints} é»ã€‚\nä¾è¦å®šç„¡æ³•ä½¿ç”¨éƒ¨åˆ†é»æ•¸æŠ˜æŠµï¼Œéœ€å…¨é¡ä»¥æ›å¸³æ–¹å¼æ”¯ä»˜ã€‚${totalMaterialFee > 0 ? '\n(å«èª²ç¨‹ææ–™è²» NT$' + totalMaterialFee + ')' : ''}\n\nç¸½æ›å¸³é‡‘é¡ï¼šNT$${fullChargeAmount} å…ƒ\næ˜¯å¦ç¢ºèªé ç´„ï¼Ÿ`;

                     const confirmed = await showPopup({
                        title: 'é»æ•¸ä¸è¶³', 
                        message: msg, 
                        icon: 'warning',
                        showCancel: true,
                        confirmText: 'ç¢ºèªæ›å¸³',
                        confirmClass: 'danger'
                     });
                     
                     if (confirmed) {
                         // ä¸æ‰£é™¤é»æ•¸ï¼Œå…¨é¡æ›å¸³
                         addChargeAmount(fullChargeAmount);
                         executeBooking('charge', fullChargeAmount);
                     }
                     return;
                 }
                 deductPoints(pointsNeeded);
                 
                 if (totalMaterialFee > 0) {
                     addChargeAmount(totalMaterialFee);
                     executeBooking('mixed', totalMaterialFee);
                 } else {
                     executeBooking('points', 0);
                 }
            } else if (paymentMethod === 'bill') {
                 chargeAmount = (pointsNeeded * 10) + totalMaterialFee;
                 addChargeAmount(chargeAmount);
                 executeBooking('charge', chargeAmount);
            }
        } else {
            // å€™è£œä¹Ÿè¦æª¢æŸ¥é»æ•¸
            const userPoints = getUserPoints();
            if (userPoints < pointsNeeded) {
                 await showPopup({
                    title: 'é»æ•¸ä¸è¶³', 
                    message: `æ‚¨çš„é»æ•¸ (${userPoints} é») ä¸è¶³æ”¯ä»˜æ­¤èª²ç¨‹ (${pointsNeeded} é»)ï¼Œç„¡æ³•åŠ å…¥å€™è£œã€‚`, 
                    icon: 'error'
                 });
                 return;
            }
            executeBooking(null, 0);
        }
    });

    function getUserPoints() {
      // æ¨¡æ“¬å¾ localStorage æˆ– API ç²å–ç”¨æˆ¶é»æ•¸
      // é è¨­çµ¦äºˆ 1000 é»ï¼Œç¢ºä¿é»æ•¸è¶³å¤ æ¸¬è©¦
      return parseInt(localStorage.getItem('sl_user_points') || '1000');
    }

    function deductPoints(points) {
      const currentPoints = getUserPoints();
      const newPoints = Math.max(0, currentPoints - points);
      localStorage.setItem('sl_user_points', newPoints.toString());
    }

    // æ›å¸³ç®¡ç†å‡½æ•¸
    function addChargeAmount(amount) {
      const currentCharge = parseInt(localStorage.getItem('sl_charge_amount') || '0');
      const newCharge = currentCharge + amount;
      localStorage.setItem('sl_charge_amount', newCharge.toString());
    }

    function getChargeAmount() {
      return parseInt(localStorage.getItem('sl_charge_amount') || '0');
    }

    function getSelectedMaterials() {
        const container = document.getElementById('material-items-container');
        const selected = [];
        container.querySelectorAll('.option-card.selected').forEach(card => {
            selected.push({
                name: card.dataset.name,
                price: parseInt(card.dataset.price)
            });
        });
        return selected;
    }

    function updateTotalCharge() {
        // Optional: Update UI if needed
    }

    function saveCourseBooking(course, isWaitlist, paymentMethod = 'points', chargeAmount = 0, selectedMaterials = []) {
      const KEY = 'sl_course_bookings';
      let bookings = [];
      try {
        bookings = JSON.parse(localStorage.getItem(KEY) || '[]');
      } catch {
        bookings = [];
      }

      const booking = {
        id: `${course.id}-${Date.now()}`,
        courseId: course.id,
        name: course.name,
        category: course.category,
        tags: course.tags,
        type: course.type,
        instructor: course.instructor,
        day: course.day,
        time: course.time,
        site: course.site,
        points: course.points,
        sessions: course.sessions,
        status: isWaitlist ? 'å€™è£œä¸­' : 'å·²é ç´„',
        bookingDate: new Date().toISOString(),
        isWaitlist: isWaitlist,
        paymentMethod: isWaitlist ? null : paymentMethod,
        chargeAmount: isWaitlist ? 0 : chargeAmount,
        selectedMaterials: selectedMaterials
      };

      bookings.push(booking);
      localStorage.setItem(KEY, JSON.stringify(bookings));
    }

    // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
    document.addEventListener('DOMContentLoaded', loadCourseDetail);
  </script>
</body>
</html>